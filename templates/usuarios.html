{% extends 'base1.html' %}
{% load static %}

{% block head %}
<link rel="stylesheet" href="{% static '_esporotricose_humana/css/registros.css' %}">
<script src="{% static 'base/js/usuarios.js' %}" defer></script>

<link rel="stylesheet" href="{% static 'base/css/virtual-select.min.css' %}" />
<style>
    
</style>
{% endblock head %}

{% block content %}
<div class="mt-3">
    <div class="alert alert-primary text-center">
        <h1 class="fs-2">Usuários</h1>
    </div>
    <div class="row">
        <div class="col">
            <input class="form-control" type="text" id="pesquisar-registros" placeholder="Pesquisar...">
        </div>        
    </div>
    
    {% include 'messages/message.html' %}
    <div class="mt-3">
        <table class="table table-bordered">
            <thead>
                <th scope="col">NOME</th>
                <th scope="col">TELEFONE</th>
                <th scope="col">MUNICIPIO</th>
                <th scope="col">AGRAVOS (** Solicitação)</th>
                <th scope="col">FUNÇÃO</th>
            </thead>
            <tbody id="table-registros">
                {% for usuario in usuarios %}
                <tr class="align-middle">
                    <td>{{usuario.username}}</td>
                    <td>{{usuario.telefone}}</td>
                    <td>{{usuario.municipio}}</td>                        
                    <td class="text-center">
                        
                        <select class="agravos-select" id="{{usuario.id}}" multiple name="native-select" placeholder="Selecione os Agravos" data-search="true" data-silent-initial-value-set="true">
                        {% for agravo in request.user.lista_agravos_permite %}        
                        {% if agravo == 'esp-hum' %}
                        
                            {% if usuario.esp_hum %}
                            <option value="esp-hum" selected>Esporotricose Humana</option>
                            {% else %}
                            <option value="esp-hum">
                                {% if usuario.esp_hum_solicit %}
                                <strong style="color: red !important">**</strong>
                                {% endif %} 
                                Esporotricose Humana
                            </option>
                            {% endif %}
                            
                        {% elif agravo == 'act' %}
                            
                            {% if usuario.act %}
                            <option value="act" selected>Acidentes de Transito</option>
                            {% else %}
                            <option value="act">
                                {% if usuario.act_solicit %}
                                <strong style="color: red !important">**</strong>
                                {% endif %}
                                Acidentes de Transito
                            </option>                                                           
                            {% endif %} 
                            
                        {% endif %}
                        {% endfor %}
                        </select>    
                    </td>                 
                    <td>
                        <select class="funcoes-select form-select" id="{{usuario.id}}">
                        {% for funcao in funcoes %}
                            {% if funcao.value == usuario.funcao %}
                            <option value="{{funcao.value}}" selected>{{funcao.name}}</option>
                            {% else %}
                            <option value="{{funcao.value}}">{{funcao.name}}</option>
                            {% endif %}
                        {% endfor %}
                        </select>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    </div>    
</div>
{% endblock content %}

{% block endbody %}
<script src="{% static 'base/js/virtual-select.min.js' %}"></script>
<script>
    VirtualSelect.init({
        ele: '.agravos-select'
    });
</script>
{% endblock endbody %}