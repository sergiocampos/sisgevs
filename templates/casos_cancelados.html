{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <title>SISGEVS - Sistema de Informação em Saúde da GEVS</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

  <script src="https://code.highcharts.com/highcharts.src.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.15/jquery.mask.min.js"></script>

  <style>
    .fakeimg {
      height: 500px;
      background: #aaa;
    }

    #content__table_id {
      max-height: 400px;
      overflow-y: scroll;
    }
  </style>

  <style>
    * {
      box-sizing: border-box;
    }

    body {
      font-family: Arial, Helvetica, sans-serif;
    }

/* Style the header */
header {
  padding: 1px;
  text-align: center;
  font-size: 35px;
  color: black;
}

/* Container for flexboxes */
section {
  display: -webkit-flex;
  display: flex;
}

/* Style the navigation menu */
nav {
  -webkit-flex: 0.5;
  -ms-flex: 0.5;
  flex: 0.5;
  background: #e6e6e6;
  padding: 20px;
}

/* Style the list inside the menu */
nav ul {
  list-style-type: none;
}

/* Style the content */
article {
  -webkit-flex: 3;
  -ms-flex: 3;
  flex: 3;
  background-color: #f1f1f1;
  padding: 10px;
}

/* Style the footer */
footer {
  background-color: #777;
  padding: 10px;
  text-align: center;
  color: white;
}

/* Responsive layout - makes the menu and the content (inside the section) sit on top of each other instead of next to each other */
@media (max-width: 600px) {
  section {
    -webkit-flex-direction: column;
    flex-direction: column;
  }
}
.usuario_log{
  margin: 3px;
  border-radius: 8px;
  background-color: #17a2b8;
  color: white;
  cursor: default;
}
</style>

<link rel="shortcut icon" href="https://docs.google.com/uc?id=1h8jgyPDlDWWinD_VP50nqKXnmdCHEKH3" type="image/x-icon" />




</head>
<body>

  <nav class="navbar navbar-expand-sm bg-info navbar-light" style="background-color: #e6e6e6;">
    <ul class="navbar-nav">
      <li class="nav-item active">
        <a class="nav-link" href="#"></a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="#"></a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="#"></a>
      </li>
      <li class="nav-item">
        <a class="nav-link disabled" href="#"></a>
      </li>
    </ul>
  </nav>
  <header>
    <div class="" style="background-color: #e6e6e6;">
      <div class="row">
        <div class="col" style="padding: 0; margin-top: 10px; text-align: center;">
          <h4>SECRETARIA DE ESTADO DA SAÚDE DA PARAÍBA</h4>
          <h6>SISGEVS - Sistema de Informação em Saúde da GEVS</h6>
          <h6><b>----</b></h6>
        </div>
      </div>
    </div>
  </header>

<nav class="navbar navbar-expand-sm bg-secondary navbar-dark">
  <a class="navbar-brand" href="#"></a>
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#collapsibleNavbar">
    <span class="navbar-toggler-icon"></span>
  </button>
  <div class="collapse navbar-collapse" id="collapsibleNavbar">
    <ul class="navbar-nav">
      <li class="nav-item">
        <a class="nav-link" href="/principal/">Principal</a>
      </li>
      <!--
      {% if user.funcao == 'gerencia_executiva' or user.funcao == 'admin' %}
      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#">Localizar Notificação</a>
        <div class="dropdown-menu">
          <a class="dropdown-item" href="/localizar_paciente_nome/">Nome Paciente</a>
          <a class="dropdown-item" href="/localizar_paciente_data_coleta/">Data de Coleta</a>
          <a class="dropdown-item" href="#">CPF</a>
          <a class="dropdown-item" href="#">Telefone</a>
        </div>
      </li>
      {% endif %}
    -->
      {% if user.funcao == 'admin' or user.funcao == 'municipal' or user.funcao == 'autocadastro' %}
      <li class="nav-item">
        <a class="nav-link" href="/all_forms/">Notificar</a>
      </li>
      {% endif %}
      
      <li class="nav-item">
        <a class="nav-link" href="/logout/">Sair</a>
      </li>
    </ul>
  </div>
</nav>
    <section>
      <nav>
        <ul style="padding:0;">
          <li>
            <div class="usuario_log">
              <div style="padding: 5px;">
                <span><b>Usuário:</b> {{user.login}}</span><br>
                <b>Perfil: </b><span id="user_funcao">{{user.funcao}}</span>
              </div>
            </div>            
          </li>
        </ul>
        <ul style="padding-left: 5%;">
          <div id="demo" class="collapsed">
            <li><a href="/dados_user/">Meus Dados</a></li>
            <hr>
            {% if user.funcao == 'admin' %}
              <li><a href="/admin/">Gerenciar Contas</a></li>
              <hr>
              <!--
              <li><a href="/organograma/">Organograma</a></li>
              <hr>
              -->
            {% endif %}
            {% if user.funcao != 'gerencia_regional' and user.funcao != 'municipal' and user.funcao != 'autocadastro' %}
              <li><a href="/criar_perfil_municipal/">Criar Perfil Municipal</a></li>
              <hr>
            {% endif %}
            {% if user.funcao == 'admin' or user.funcao == 'municipal' or user.funcao == 'autocadastro' %}
            <!--
            <li><a href="/all_forms/" data-toggle="collapse" data-target="#formularios">Formulários</a></li>
            <div id="formularios" class="collapse">
              <li><a href="/caso_esporotricose_create/">Esporotricose Humana</a></li>
              <li><a href="/main/">Chikungunya</a></li>
              <li><a href="/main/">Dengue</a></li>
              <li><a href="/main/">Zika</a></li>
            </div>
            <hr>
          -->
            {% endif %}
            <li><a href="/my_datas/">Notificações</a></li>
            <hr>
            {% if user.funcao == 'admin' %}
            <li>Casos cancelados</li>
            <hr>
            {% endif %}
          </div>
        </ul>
      </nav>


      <article>

        <div class="container" style="margin-left: 0;" id="container">
          <div class="row">
            <div class="col-sm-12">
              <div class="alert alert-primary" style="text-align: center;">
                <strong style="align-items: center;">Casos Cancelados</strong>
              </div>
            </div>
          </div>
          {% if regs %}
          <div class="row">
            <div class="col col-sm-4">
              <input class="form-control" type="text" id="pesquisar" placeholder="digite algo para pesquisar">             
            </div>
            <div class="col">
              <form class="row" name="" id="" enctype="multipart/form-data" action="/export_data_csv/" method="get">{% csrf_token %}
                <div class="col">
                  <div class="input-group" id="">
                    <div class="input-group-prepend" id="">
                      <span class="input-group-text">Início</span>
                    </div>
                    <input type="date" id="filtro_data_inicio" name="filtro_data_inicio" class="form-control">
                  </div>
                </div>
                <div class="col">
                  <div class="input-group" id="">
                    <div class="input-group-prepend" id="">
                      <span class="input-group-text">Fim</span>
                    </div>
                    <input type="date" id="filtro_data_fim" name="filtro_data_fim" class="form-control">
                  </div>
                </div>
                <div class="col col-sm-3">
                  <button type="submit" class="btn btn-primary btn-sm">Exportar Dados</button>                
                </div>
              </form>            
            </div>
          </div>


          <style>
            .table          { overflow-y: auto; height: 100px; }
            .table thead th { position: sticky; top: -1px; background-color: #d9d9d9; z-index: 2;}

          </style>
          

          <script>
            $(document).ready(function(){
              $("#pesquisar").on("keyup", function() {
                var value = $(this).val().toLowerCase();
                $("#myTable tr").filter(function() {
                  $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
                });
              });
            });
          </script>



          <br>
          
          {% include 'messages/message.html' %}
          <div id="content__table_id">          
          <table class="table table-bordered" style="font-size: 80%;">
            <thead>
              
                <th>Data Notificação</th>
                <th>Nome Paciente</th>
                <th>Data Nasc.</th>
                <th>Nome da Mãe</th>
                <th>Município de Residência</th>
                <th>Município Notificador</th>
                <th style="text-align: center; width: 280px">Ações</th>

              
            </thead>
            <tbody id="myTable">
              {% for registro in regs %}
              <tr class="table table-warning">
                
                {% if registro.data_notificacao != None %}
                <td>{{registro.data_notificacao}}</td>
                {%else%}
                <td></td>
                {%endif%}
                

                <td>{{registro.nome_paciente}}</td>
                
                {% if registro.data_nascimento_paciente != None %}
                <td>{{registro.data_nascimento_paciente}}</td>
                {%else%}
                <td></td>
                {%endif%}
                
                {% if registro.nome_mae_paciente == None %}
                  <td></td>
                {% else %}
                  <td>{{registro.nome_mae_paciente}}</td>
                {% endif %}
                {% if registro.municipio_residencia != None %}
                  <td>{{registro.municipio_residencia}}</td>
                {% else %}
                  <td></td>
                {% endif %}
                
                {% if registro.municipio != None %}
                  {% for i in municipios %}
                    {% if i.id == registro.municipio %}
                      <td>{{i}}</td>                 
                    {% endif %}                    
                  {% endfor %}
                {% else %}
                  <td></td>
                {% endif %}

                <td align="center">
                  <button id="{{registro.id}}" type="button" class="btn cancelar_caso btn-secondary btn-sm">Revalidar</button>                
                </td>                
              </tr>
              {% endfor %}
            </tbody>
          </table>
          {% else %}
          <h5 class="font-weight-bolder text-center mt-3">Nenhum caso cancelado.</h5>
          {% endif %}
          </div>
        </div>
      </article>
    </section>
    <br><br>

    <!--
    <div class="pagination py-4">
      <span class="step-links" style="margin: auto">
        {% if regs.has_previous %}
         <a href="?page={{regs.previous_page_number}}">Anterior</a>
        {% endif %}
        <span class="current text-center" style="border: 1px solid #aaa; border-radius: 4px; padding: 5px; padding-right: 2px; margin: 10px;">
        {{regs.number}} de {{regs.paginator.num_pages}}
        </span>
        {% if regs.has_next %}
         <a href="?page={{regs.next_page_number}}"> Próximo</a>
         {% endif %}                
      </span> 
    </div>
  -->

    <div class="jumbotron text-center" style="margin-bottom:0">
      <p>Footer</p>
      <i class="fa">&#xf1f9;</i>
    </div>
    <br>
    <script>
      $('.cancelar_caso').on('click', function(){
        var id = this.id;
        var data = {
                      'id':id,
                      'url_redirect': 'my_datas'
                   }
        $.ajax({
          url: "{% url 'cancelar_caso_esporotricose' %}",
          data: data,
          success: function(data){
            document.location.href='casos_cancelados'
          }          
        })
      });      
    </script>    
    <script src="{% static 'js/funcao_user.js' %}"></script>
  </body>
  </html>